<%= render 'providers_navigation', title: 'Providers' %>

<%= render PaginatedFilterComponent.new(filter: @filter, collection: @providers) do %>
  <table class="govuk-table">
    <thead class="govuk-table__head">
      <tr class="govuk-table__row">
        <th scope="col" class="govuk-table__header govuk-!-width-one-half">Provider name</th>
        <th scope="col" class="govuk-table__header">Courses</th>
        <th scope="col" class="govuk-table__header">Sites</th>
        <th scope="col" class="govuk-table__header">DSA signed date</th>
      </tr>
    </thead>

    <tbody class="govuk-table__body">
      <% @providers.each do |provider| %>
        <tr class="govuk-table__row">
          <td class="govuk-table__cell">
            <span class="govuk-!-display-block govuk-!-margin-bottom-1">
              <%= govuk_link_to provider.name_and_code, support_interface_provider_path(provider) %>
            </span>
            <% if provider.no_admin_users? %>
              <%= render TagComponent.new(text: 'Needs attention', type: :red) %>
            <% end %>
          </td>
          <td class="govuk-table__cell">
            <%= pluralize provider.courses.size, 'course' %><br/>
            <%= provider.courses.open_on_apply.size %> on DfE Apply
          </td>
          <td class="govuk-table__cell">
            <%= provider.sites.size %>
          </td>
          <td class="govuk-table__cell">
            <% if provider.provider_agreements.data_sharing_agreements.any? %>
              <%= provider.provider_agreements.data_sharing_agreements.first.accepted_at.to_s(:govuk_date) %>
            <% else %>
              Not accepted yet
            <% end %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% end %>
