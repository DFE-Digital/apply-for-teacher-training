<% content_for :title, 'Feature metrics' %>

<% content_for :before_content do %>
  <%= render BreadcrumbComponent.new(items: [{
    text: 'Performance',
    path: support_interface_performance_path,
  }, {
    text: 'Feature metrics',
  }]) %>
<% end %>

<h2 class="govuk-heading-m govuk-!-font-size-27 govuk-!-margin-top-8">References</h2>
<div id="references_dashboard_section" class="govuk-grid-row govuk-!-margin-bottom-4">
  <div class="govuk-grid-column-one-half">
    <div id="headline-stat" class="govuk-!-margin-bottom-4">
      <%= render SupportInterface::TileComponent.new(
        count: @dashboard.avg_time_to_get_references,
        label: 'average time to get reference back',
        colour: :blue,
        size: :reduced,
      ) %>
    </div>
    <div class="govuk-grid-row govuk-!-margin-bottom-4">
      <div class="govuk-grid-column-one-half">
        <%= render SupportInterface::TileComponent.new(
          count: @dashboard.avg_time_to_get_references_this_month,
          label: 'this month',
          size: :reduced,
        ) %>
      </div>
      <div class="govuk-grid-column-one-half">
        <%= render SupportInterface::TileComponent.new(
          count: @dashboard.avg_time_to_get_references_last_month,
          label: 'last month',
          size: :reduced,
        ) %>
      </div>
    </div>
  </div>

  <div class="govuk-grid-column-one-half">
    <div id="headline-stat" class="govuk-!-margin-bottom-4">
      <%= render SupportInterface::TileComponent.new(
        count: @reference_statistics.percentage_references_within(
          30,
          EndOfCycleTimetable.apply_reopens.beginning_of_day,
        ),
        label: 'completed within 30 days',
        colour: :blue,
        size: :reduced,
      ) %>
    </div>
    <div class="govuk-grid-row govuk-!-margin-bottom-4">
      <div class="govuk-grid-column-one-half">
        <%= render SupportInterface::TileComponent.new(
          count: @reference_statistics.percentage_references_within(
            30,
            Time.zone.now.beginning_of_month,
          ),
          label: 'this month',
          size: :reduced,
        ) %>
      </div>
      <div class="govuk-grid-column-one-half">
        <%= render SupportInterface::TileComponent.new(
          count: @reference_statistics.percentage_references_within(
            30,
            Time.zone.now.beginning_of_month - 1.month,
            Time.zone.now.beginning_of_month,
          ),
          label: 'last month',
          size: :reduced,
        ) %>
      </div>
    </div>
  </div>
</div>

<h3 class="govuk-heading-m govuk-!-font-size-27 govuk-!-margin-top-8">Work history</h3>
<div id="work_history_dashboard_section" class="govuk-grid-row govuk-!-margin-bottom-4">
  <div class="govuk-grid-column-one-half">
    <div id="headline-stat" class="govuk-!-margin-bottom-4">
      <%= render SupportInterface::TileComponent.new(
        count: @work_history_statistics.average_time_to_complete(
          EndOfCycleTimetable.apply_reopens.beginning_of_day,
        ),
        label: 'time to complete',
        colour: :blue,
        size: :reduced,
      ) %>
    </div>
    <div class="govuk-grid-row govuk-!-margin-bottom-4">
      <div class="govuk-grid-column-one-half">
        <%= render SupportInterface::TileComponent.new(
          count: @work_history_statistics.average_time_to_complete(
            Time.zone.now.beginning_of_month,
          ),
          label: 'this month',
          size: :reduced,
        ) %>
      </div>
      <div class="govuk-grid-column-one-half">
        <%= render SupportInterface::TileComponent.new(
          count: @work_history_statistics.average_time_to_complete(
            Time.zone.now.beginning_of_month - 1.month,
            Time.zone.now.beginning_of_month,
          ),
          label: 'last month',
          size: :reduced,
        ) %>
      </div>
    </div>
  </div>
</div>

<h3 class="govuk-heading-m govuk-!-font-size-27 govuk-!-margin-top-8">Accessing the service</h3>
<div id="accessing_the_service_dashboard_section" class="govuk-grid-row govuk-!-margin-bottom-4">
  <div id="accessing_the_service_to_unsubmitted_dashboard_section" class="govuk-grid-column-one-third">
    <div id="headline-stat" class="govuk-!-margin-bottom-4">
      <%= render SupportInterface::TileComponent.new(
        count: @magic_link_statistics.average_magic_link_requests_upto(
          :created_at,
          EndOfCycleTimetable.apply_reopens.beginning_of_day,
        ),
        label: 'average number of sign-ins before submitting application',
        colour: :blue,
        size: :reduced,
      ) %>
    </div>
    <div class="govuk-grid-row govuk-!-margin-bottom-4">
      <div class="govuk-grid-column-one-half">
        <%= render SupportInterface::TileComponent.new(
          count: @magic_link_statistics.average_magic_link_requests_upto(
            :created_at,
            Time.zone.now.beginning_of_month,
          ),
          label: 'this month',
          size: :reduced,
        ) %>
      </div>
      <div class="govuk-grid-column-one-half">
        <%= render SupportInterface::TileComponent.new(
          count: @magic_link_statistics.average_magic_link_requests_upto(
            :created_at,
            Time.zone.now.beginning_of_month - 1.month,
            Time.zone.now.beginning_of_month,
          ),
          label: 'last month',
          size: :reduced,
        ) %>
      </div>
    </div>
  </div>
  <div id="accessing_the_service_to_offer_dashboard_section" class="govuk-grid-column-one-third">
    <div id="headline-stat" class="govuk-!-margin-bottom-4">
      <%= render SupportInterface::TileComponent.new(
        count: @magic_link_statistics.average_magic_link_requests_upto(
          :offered_at,
          EndOfCycleTimetable.apply_reopens.beginning_of_day,
        ),
        label: 'average number of sign-ins before offer',
        colour: :blue,
        size: :reduced,
      ) %>
    </div>
    <div class="govuk-grid-row govuk-!-margin-bottom-4">
      <div class="govuk-grid-column-one-half">
        <%= render SupportInterface::TileComponent.new(
          count: @magic_link_statistics.average_magic_link_requests_upto(
            :offered_at,
            Time.zone.now.beginning_of_month,
          ),
          label: 'this month',
          size: :reduced,
        ) %>
      </div>
      <div class="govuk-grid-column-one-half">
        <%= render SupportInterface::TileComponent.new(
          count: @magic_link_statistics.average_magic_link_requests_upto(
            :offered_at,
            Time.zone.now.beginning_of_month - 1.month,
            Time.zone.now.beginning_of_month,
          ),
          label: 'last month',
          size: :reduced,
        ) %>
      </div>
    </div>
  </div>
  <div id="accessing_the_service_to_recruitment_dashboard_section" class="govuk-grid-column-one-third">
    <div id="headline-stat" class="govuk-!-margin-bottom-4">
      <%= render SupportInterface::TileComponent.new(
        count: @magic_link_statistics.average_magic_link_requests_upto(
          :recruited_at,
          EndOfCycleTimetable.apply_reopens.beginning_of_day,
        ),
        label: 'average number of sign-ins before recruitment',
        colour: :blue,
        size: :reduced,
      ) %>
    </div>
    <div class="govuk-grid-row govuk-!-margin-bottom-4">
      <div class="govuk-grid-column-one-half">
        <%= render SupportInterface::TileComponent.new(
          count: @magic_link_statistics.average_magic_link_requests_upto(
            :recruited_at,
            Time.zone.now.beginning_of_month,
          ),
          label: 'this month',
          size: :reduced,
        ) %>
      </div>
      <div class="govuk-grid-column-one-half">
        <%= render SupportInterface::TileComponent.new(
          count: @magic_link_statistics.average_magic_link_requests_upto(
            :recruited_at,
            Time.zone.now.beginning_of_month - 1.month,
            Time.zone.now.beginning_of_month,
          ),
          label: 'last month',
          size: :reduced,
        ) %>
      </div>
    </div>
  </div>
</div>

<h3 class="govuk-heading-m govuk-!-font-size-27 govuk-!-margin-top-8">Reasons for rejection</h3>
<div id="reasons_for_rejection_dashboard_section" class="govuk-grid-row govuk-!-margin-bottom-4">
  <div class="govuk-grid-column-one-half">
    <div id="headline-stat" class="govuk-!-margin-bottom-4">
      <%= render SupportInterface::TileComponent.new(
        count: @reasons_for_rejection_statistics.rejections_due_to(
          :qualifications_y_n,
          EndOfCycleTimetable.apply_reopens.beginning_of_day,
        ),
        label: 'rejections due to qualifications',
        colour: :blue,
        size: :reduced,
      ) %>
    </div>
    <div class="govuk-grid-row govuk-!-margin-bottom-4">
      <div class="govuk-grid-column-one-half">
        <%= render SupportInterface::TileComponent.new(
          count: @reasons_for_rejection_statistics.rejections_due_to(
            :qualifications_y_n,
            Time.zone.now.beginning_of_month,
          ),
          label: 'this month',
          size: :reduced,
        ) %>
      </div>
      <div class="govuk-grid-column-one-half">
        <%= render SupportInterface::TileComponent.new(
          count: @reasons_for_rejection_statistics.rejections_due_to(
            :qualifications_y_n,
            Time.zone.now.beginning_of_month - 1.month,
            Time.zone.now.beginning_of_month,
          ),
          label: 'last month',
          size: :reduced,
        ) %>
      </div>
    </div>
  </div>
</div>
