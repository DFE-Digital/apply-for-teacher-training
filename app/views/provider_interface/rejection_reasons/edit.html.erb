<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <%= form_with model: @wizard, url: provider_interface_reject_path do |f| %>

      <%= f.govuk_error_summary %>

      <span class="govuk-caption-l"><%= @application_choice.application_form.full_name %></span>
      <h1 class="govuk-heading-l">Reasons for rejecting this application</h1>
      <p class="govuk-body">The candidate will see this feedback.</p>

      <% @wizard.class.questions.each do |question_key, question_config| %>
        <%= f.govuk_check_boxes_fieldset(question_key, legend: { text: question_config['text'], size: 'm' }) do %>
          <%= f.govuk_check_box question_key, 'Yes', label: { text: question_config['text'] }, link_errors: true do %>
            <% if question_config.key?('reasons') %>
              <% collection_attr = :"#{question_key}_reasons" %>
              <%= f.govuk_check_boxes_fieldset collection_attr, legend: { text: 'Reasons', size: 's' } do %>
                <% question_config['reasons'].each do |reason_key, reason_config| %>
                  <%= f.govuk_check_box collection_attr,
                    reason_key,
                    label: { text: reason_config['text'] },
                    link_errors: true do %>
                    <% if reason_config.key?('details') %>
                      <% reason_attr = :"#{reason_key}_details" %>
                      <%= f.govuk_text_area reason_attr, label: { text: reason_config.dig('details', 'text') }, max_words: 100 %>
                    <% end %>
                  <% end %>
                <% end %>
              <% end %>
            <% end %>
          <% end %>
        <% end %>
      <% end %>
    <% end %>
  </div>
</div>
