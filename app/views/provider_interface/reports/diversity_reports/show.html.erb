<%= content_for :title, t('page_titles.provider.diversity_report') %>
<%= content_for :before_content, breadcrumbs(t('page_titles.provider.reports') => provider_interface_reports_path,
                                             t('page_titles.provider.diversity_report') => nil) %>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <h1 class="govuk-heading-l">
      <span class="govuk-caption-l"> <%= @provider.name %></span>
      <%= t('page_titles.provider.diversity_report') %>
    </h1>
  </div>
</div>

<% if @completed_e_and_d_survey_count < 10 %>
  <p class="govuk-body">
    You’ll be able to see this report once it contains data from at least 10 candidates. This is to protect the privacy of candidates.
  </p>
<% else %>
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
      <p class="govuk-body">
        <%= govuk_link_to 'Export data (ZIP)', provider_interface_reports_provider_diversity_report_path(provider_id: @provider, format: :zip) %>
      </p>
      <h2 class="govuk-heading-m">Sex</h3>
      <%= render ProviderInterface::ReportTableComponent.new(headers: ['Sex',
                                                                       'Applied',
                                                                       'Offered',
                                                                       'Recruited',
                                                                       'Percentage recruited'],
                                                             rows: @diversity_report_sex_data,
                                                             show_footer: true,
                                                             exclude_from_footer: ['Percentage recruited'],
                                                             bold_row_headers: false) %>

      <h2 class="govuk-heading-m">Disability and health conditions</h3>
      <p class="govuk-body">This question is separate from asking candidates if they need support with their application or training.</p>
      <p class="govuk-body">Candidates can select multiple disabilities or health conditions, so the numbers may not match totals.</p>
      <%= render ProviderInterface::ReportTableComponent.new(headers: ['Disability or health condition',
                                                                       'Applied',
                                                                       'Offered',
                                                                       'Recruited',
                                                                       'Percentage recruited'],
                                                             rows: @diversity_report_disability_data,
                                                             show_footer: true,
                                                             exclude_from_footer: ['Percentage recruited'],
                                                             bold_row_headers: false) %>

      <h2 class="govuk-heading-m">Ethnicity</h3>
      <%= render ProviderInterface::ReportTableComponent.new(headers: ['Ethnic group',
                                                                       'Applied',
                                                                       'Offered',
                                                                       'Recruited',
                                                                       'Percentage recruited'],
                                                             rows: @diversity_report_ethnicity_data,
                                                             show_footer: true,
                                                             exclude_from_footer: ['Percentage recruited'],
                                                             bold_row_headers: false) %>

      <h2 class="govuk-heading-m">Age</h3>
      <%= render ProviderInterface::ReportTableComponent.new(headers: ['Age group',
                                                                       'Applied',
                                                                       'Offered',
                                                                       'Recruited',
                                                                       'Percentage recruited'],
                                                             rows: @diversity_report_age_data,
                                                             show_footer: true,
                                                             exclude_from_footer: ['Percentage recruited'],
                                                             bold_row_headers: false) %>

      <h2 class="govuk-heading-m">About this data</h2>
        <p class="govuk-body">
          This data comes from candidates who submitted an application from <%= CycleTimetable.apply_opens.to_fs(:govuk_date) %>.
        </p>
        <p class="govuk-body">
          The sex, disability and ethnicity data comes from <%= @completed_e_and_d_survey_count %> candidates who filled in a questionnaire when they applied. This is <%= (@completed_e_and_d_survey_count / @total_submitted_applications) * 100 %>% of the total candidates.
        </p>
        <p class="govuk-body">
          The age data is from all <%= @total_submitted_applications %> candidates. It's based on each candidate’s age on <%= Time.zone.today.to_fs(:govuk_date) %>.
        </p>

      <h3 class="govuk-heading-s">How candidates are asked about their ethnicity</h3>
      <p class="govuk-body">
        Candidates are asked to select a general ethnic group, such as 'Asain or Asian British'. They can also select 'prefer not to say'.
      </p>
      <p class="govuk-body">
        If the candidate selects a general ethnic group then they can select a more specific background such as 'Bangladeshi'. They can also select 'prefer not to say'.
      </p>
      <h3 class="govuk-heading-s">How candidates are asked about their disabilities</h3>
      <p class="govuk-body">
        Candidates who say that they have a disability are asked about the type of disability. They can select more than one type.
      </p>
    </div>
  </div>
<% end %>
