<% content_for :browser_title, "#{@application_choice.application_form.full_name} â€“ #{@application_choice.course.name_and_code}" %>

<%= render 'application_choice_header' %>

<p class="govuk-body govuk-!-margin-bottom-8 govuk-!-display-none-print">
  <%= govuk_link_to(
    'Download application (PDF)',
    provider_interface_application_choice_path(@application_choice.id, format: :pdf),
    download: @application_choice.application_form.support_reference
  ) %>
</p>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <%= render ProviderInterface::StatusBoxComponent.new(application_choice: @application_choice, options: @status_box_options) unless @offer_present %>

    <h2 class="govuk-heading-m govuk-!-font-size-27" id="application">Application</h2>
    <%= render PersonalDetailsComponent.new(application_form: @application_choice.application_form) %>

    <% unless HostingEnvironment.production? %>
      <div class="app-status-box app-status-box--sandbox govuk-!-display-none-print">
        <p class="govuk-body">
          <strong class="govuk-tag govuk-phase-banner__content__tag app-environment-tag govuk-tag--purple">Sandbox feature</strong>
        </p>
        <p class="govuk-body">
          See what this application looks like from the candidate side by signing in as <%= @application_choice.application_form.full_name %>:
        </p>
        <%= button_to 'Sign in as this candidate', provider_interface_impersonate_candidate_path(@application_choice.application_form.candidate), class: 'govuk-button govuk-!-margin-bottom-0' %>
      </div>
    <% end %>

    <%= render ProviderInterface::CourseDetailsComponent.new(application_choice: @application_choice)%>

    <%= render ProviderInterface::TrainingWithDisabilityComponent.new(application_form: @application_choice.application_form) %>

    <%= render ProviderInterface::SafeguardingDeclarationComponent.new(application_choice: @application_choice, current_provider_user: current_provider_user)%>

    <%= render InterviewPreferencesComponent.new(application_form: @application_choice.application_form) %>
  </div>
</div>

<%= render QualificationsComponent.new(application_form: @application_choice.application_form, application_choice_state: @application_choice.status) %>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <%= render ProviderInterface::WorkHistoryComponent.new(application_form: @application_choice.application_form) %>

    <%= render ProviderInterface::VolunteeringHistoryComponent.new(application_form: @application_choice.application_form) %>

    <% language_skills_component = LanguageSkillsComponent.new(application_form: @application_choice.application_form) %>
    <% if language_skills_component.render? %>
      <%= render language_skills_component %>
    <% end %>

    <%= render PersonalStatementComponent.new(application_form: @application_choice.application_form) %>

    <% if @application_choice.application_form.application_references.feedback_provided.any? %>
      <%= render 'references_context' %>

      <% @application_choice.application_form.application_references.feedback_provided.each_with_index do |reference, i| %>
        <%= render ProviderInterface::ReferenceWithFeedbackComponent.new(reference: reference, index: i ) %>
      <% end %>
    <% end %>

    <%= render ProviderInterface::DiversityInformationComponent.new(application_choice: @application_choice, current_provider_user: current_provider_user) %>
  </div>
</div>
