<% content_for :before_content, govuk_back_link_to(previous_page, 'Back') %>
<% content_for :browser_title, title_with_error_prefix('Providers', @wizard.errors.any?) %>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <%= form_with model: @wizard, url: provider_interface_update_invitation_provider_permissions_path do |f| %>
      <%= f.govuk_error_summary %>

      <%= f.fields_for "provider_permissions[]", @permissions_form do |pf| %>
        <%= pf.hidden_field :provider_id %>
        <%
          fieldset_legend_text = 'Select permissions'
          fieldset_legend_text += ": #{@provider.name}" unless @wizard.single_provider
        -%>
        <%= pf.govuk_check_boxes_fieldset(:permissions,
                legend: { text: fieldset_legend_text, size: "xl" },
                caption: { text: 'Invite user', size: "xl" }) do %>
          <span id="permissions-hint" class="govuk-hint">
            The user will be able to view all applications made to courses at these organisations. You do not need to set permissions for this.
          </span>

          <%= pf.govuk_check_box :permissions, 'manage_organisations',
                                label: { text: 'Manage organisations' },
                                hint: { text: 'Change permissions between organisations' } %>

          <%= pf.govuk_check_box :permissions, 'manage_users',
                                label: { text: 'Manage users' },
                                hint: { text: 'Invite or delete users and set their permissions' } %>

          <%= pf.govuk_check_box :permissions, 'make_decisions',
                                label: { text: 'Make decisions' },
                                hint: { text: 'Make offers, amend offers and reject applications' } %>
          <div class="govuk-body govuk-!-margin-left-6">
            <%= render AssociatedProvidersPermissionsListComponent.new(provider: @provider, permission_name: 'make_decisions') %>
          </div>

          <%= pf.govuk_check_box :permissions, 'view_safeguarding_information',
                                label: { text: 'Access safeguarding information' },
                                hint: { text: 'View sensitive material about the candidate' } %>

          <div class="govuk-body govuk-!-margin-left-6">
            <%= render AssociatedProvidersPermissionsListComponent.new(provider: @provider, permission_name: 'view_safeguarding_information') %>
          </div>

          <%= pf.govuk_check_box :permissions, 'view_diversity_information',
                                label: { text: 'Access diversity information' },
                                hint: { text: 'View diversity information about the candidate' } %>

          <div class="govuk-body govuk-!-margin-left-6">
            <%= render AssociatedProvidersPermissionsListComponent.new(provider: @provider, permission_name: 'view_diversity_information') %>
          </div>
        <% end %>
      <% end %>

      <%= f.govuk_submit 'Continue' %>
    <% end %>
  </div>
</div>
