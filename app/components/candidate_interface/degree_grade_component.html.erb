<% content_for :title, title_with_error_prefix(legend_helper, @model.errors.any?) %>
<%= form_with model: @model, url: candidate_interface_degree_grade_path, scope: :candidate_interface_degree_form do |form| %>
  <%= form.govuk_error_summary %>
  <%= form.govuk_radio_buttons_fieldset(
    :grade,
    legend: { text: legend_helper, tag: 'h1', size: 'l' },
    hint:,
  ) do %>
    <% if show_uk_grades? %>
      <% uk_grades.each_with_index do |grade, index| %>
        <%= form.govuk_radio_button :grade, grade, label: { text: grade }, link_errors: index.zero? do %>
          <% if grade == 'Other' %>
              <%= render DfE::Autocomplete::View.new(
                form,
                attribute_name: :other_grade,
                form_field: form.govuk_select(
                  :other_grade,
                  options_for_select(dfe_autocomplete_options(@model.other_grades), @model.other_grade.to_s),
                  aria: { label: 'candidate-interface-degree-form-other-grade-field-select' },
                  label: { text: t('application_form.degree.grade.other.conditional.label') },
                  width: 10,
                ),
              ) %>
          <% end %>
        <% end %>
      <% end %>
    <% elsif show_compatible_country_grades? %>
      <% compatible_international_grades.each_with_index do |grade, index| %>
        <% if grade == "Other" %>
          <%= form.govuk_radio_divider %>
          <%= form.govuk_radio_button(
                :grade,
                grade,
                link_errors: index.zero?,
                label: { text: t('application_form.degree.grade.other.compatible_international_label') },
              ) do %>

            <%= form.govuk_text_field(
                  :other_grade,
                  label: { text: t('application_form.degree.grade.other.compatible_international_conditional.label') },
                  width: 10,
                ) %>
          <% end %>

        <% else %>
          <%= form.govuk_radio_button :grade, grade, label: { text: grade }, link_errors: index.zero? %>
        <% end %>
      <% end %>
    <% else %>
      <% ['Yes', 'No', 'I do not know'].each_with_index do |decision, index| %>
        <%= form.govuk_radio_button :grade, decision, label: { text: decision }, link_errors: index.zero? do %>
          <%= form.govuk_text_field :other_grade, label: { text: label_helper }, hint: { text: hint_helper } if decision == 'Yes' %>
        <% end %>
      <% end %>
    <% end %>
  <% end %>
    <%= form.govuk_submit t('save_and_continue') %>
<% end %>
