---
openapi: 3.0.0
info:
  version: v1.1
  title: Apply API
  contact:
    name: DfE
    email: becomingateacher@digital.education.gov.uk
  description: |
    API for DfE’s Apply for teacher training service.
    Endpoints with the `/applications` prefix are considered stable.
    Experimental endpoints prefixed with `/test-data` may change or be removed.
servers:
- description: Sandbox (test environment for vendors)
  url: https://sandbox.apply-for-teacher-training.service.gov.uk/api/v1.1
- description: Production
  url: https://www.apply-for-teacher-training.service.gov.uk/api/v1.1
paths:
  "/applications/{application_id}/defer-offer":
    post:
      tags:
      - Application management
      summary: Defer an offer
      description: |
        Defers an offer to the next cycle.
        The application will transition to the `offer_deferred` status
        and the fields `offer_deferred_at` and `status_before_deferral` will be populated.
      parameters:
      - "$ref": "#/components/parameters/application_id"
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
                - meta
              properties:
                meta:
                  "$ref": "#/components/schemas/MetaData"
      responses:
        '200':
          description: An application
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/SingleApplicationResponse"
        '401':
          "$ref": "#/components/responses/Unauthorized"
        '404':
          "$ref": "#/components/responses/NotFound"
        '422':
          "$ref": "#/components/responses/UnprocessableEntity"
  "/applications/{application_id}/confirm-deferred-offer":
    post:
      tags:
      - Application management
      summary: Confirm a deferred offer
      description: |
        Confirms a deferred offer from the previous cycle to the current one.
        This call only succeeds if the same course, location and study_mode combination
        is available in the current recruitment cycle, otherwise it will return a 422.
      parameters:
      - "$ref": "#/components/parameters/application_id"
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
                - data
                - meta
              properties:
                data:
                  "$ref": "#/components/schemas/ConfirmDeferredOffer"
                meta:
                  "$ref": "#/components/schemas/MetaData"
      responses:
        '200':
          description: An application
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/SingleApplicationResponse"
        '401':
          "$ref": "#/components/responses/Unauthorized"
        '404':
          "$ref": "#/components/responses/NotFound"
        '422':
          "$ref": "#/components/responses/UnprocessableEntity"
  "/applications/{application_id}/withdraw":
    post:
      tags:
      - Application management
      summary: Withdraw an application
      description: |
        Withdraws an application or declines an offer at the candidate’s request.
      parameters:
      - "$ref": "#/components/parameters/application_id"
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
                - meta
              properties:
                meta:
                  "$ref": "#/components/schemas/MetaData"
      responses:
        '200':
          description: An application
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/SingleApplicationResponse"
        '401':
          "$ref": "#/components/responses/Unauthorized"
        '404':
          "$ref": "#/components/responses/NotFound"
        '422':
          "$ref": "#/components/responses/UnprocessableEntity"
  "/applications/{application_id}/notes/create":
    post:
      tags:
      - Note management
      summary: Create note
      description: |
        Creates a new note for this application.
        The `updated_at` timestamp will be set to the time of the API call.
        Its author details will be read from the attribution part of MetaData.
      parameters:
      - "$ref": "#/components/parameters/application_id"
      requestBody:
        description: Note details
        content:
          application/json:
            schema:
              type: object
              required:
                - meta
                - data
              properties:
                data:
                  "$ref": "#/components/schemas/CreateNote"
                meta:
                  "$ref": "#/components/schemas/MetaData"
      responses:
        '200':
          description: An application
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/SingleApplicationResponse"
        '401':
          "$ref": "#/components/responses/Unauthorized"
        '404':
          "$ref": "#/components/responses/NotFound"
        '422':
          "$ref": "#/components/responses/UnprocessableEntity"
components:
  schemas:
    ApplicationAttributes:
      type: object
      additionalProperties: false
      required:
        - notes
        - interviews
        - withdrawn_or_declined_for_candidate
        - withdrawn_at
      properties:
        interviews:
          type: array
        notes:
          type: array
          items:
            "$ref": "#/components/schemas/Note"
        withdrawn_at:
          type: string
          format: date-time
          description: Date and time the application was withdrawn
          example: 2019-09-18T15:33:49.216Z
          nullable: true
        withdrawn_or_declined_for_candidate:
          type: boolean
          nullable: true
          description: Was application withdrawn or offer declined at candidate’s request
          example: true
    ConfirmDeferredOffer:
      type: object
      additionalProperties: false
      required:
      - conditions_met
      properties:
        conditions_met:
          type: boolean
          description: Determines the status of the confirmed deferred application (recruited vs. pending_conditions)
          example: true
    Withdrawal:
      type: object
      additionalProperties: false
      required:
      - reason
      - date
      properties:
        reason:
          type: string
          description: Optional. The candidate’s reason for withdrawing. This field is deprecated because the Apply service does not collect this information
          maxLength: 10240
          nullable: true
          deprecated: true
        date:
          type: string
          format: date-time
          description: Time of the withdrawal
          example: 2019-09-18T15:33:49.216Z
    CreateNote:
      type: object
      additionalProperties: false
      required:
      - message
      properties:
        message:
          type: string
          description: The content of the note
          example: 'This candidate can only interview remotely'
          maxLength: 500
    Note:
      type: object
      additionalProperties: false
      required:
      - id
      - message
      - created_at
      - updated_at
      - author
      properties:
        id:
          type: string
          description: |
            The unique ID of this note. Automatically generated by our service.
          example: 123456
        message:
          type: string
          description: The content of the note
          example: 'This candidate can only interview remotely'
          maxLength: 500
        created_at:
          type: string
          format: date-time
          description: Date and time the original note was created
          example: 2019-09-18T15:33:49.216Z
        updated_at:
          type: string
          format: date-time
          description: Date and time the note was updated
          example: 2019-09-18T15:33:49.216Z
        author:
          type: string
          description: Author’s name
          example: John Smith
