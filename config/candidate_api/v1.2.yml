---
openapi: 3.0.0
info:
  version: v1.1
  title: Apply candidate API
  contact:
    name: DfE
    email: becomingateacher@digital.education.gov.uk
  description: |
    API for candidates from DfE’s Apply for teacher training service.
servers:
- description: Sandbox (test environment)
  url: https://sandbox.apply-for-teacher-training.service.gov.uk/candidate-api
- description: Production
  url: https://www.apply-for-teacher-training.service.gov.uk/candidate-api
paths:
  "/candidates":
    get:
      summary: Get a list of candidates
      parameters:
        - in: query
          name: updated_since
          schema:
            type: string
            format: date-time
            example: 2021-05-20T12:34:00Z
          required: true
          description: Records updated since this date
        - in: query
          name: page
          schema:
            type: integer
            example: 2
          required: false
          description: Page number
        - in: query
          name: per_page
          schema:
            type: integer
            example: 20
          required: false
          description: Number of records to return per page
      responses:
        '200':
          description: Candidate data updated since a certain date and time
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/CandidateList"
        '401':
          "$ref": "#/components/responses/Unauthorized"
        '422':
          "$ref": "#/components/responses/UnprocessableEntity"
components:
  responses:
    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            "$ref": "#/components/schemas/UnauthorizedResponse"
    UnprocessableEntity:
      description: Returned when the request body was missing data or contained invalid
        data
      content:
        application/json:
          schema:
            oneOf:
              - "$ref": "#/components/schemas/ParameterMissingResponse"
              - "$ref": "#/components/schemas/ParameterInvalidResponse"
              - "$ref": "#/components/schemas/PageParameterInvalidResponse"
              - "$ref": "#/components/schemas/PerPageParameterInvalidResponse"
  schemas:
    CandidateList:
      type: object
      required:
      - data
      properties:
        data:
          type: array
          items:
            "$ref": "#/components/schemas/Candidate"
    Candidate:
      type: object
      required:
        - id
        - type
        - attributes
      properties:
        id:
          type: string
          description: A candidate’s id
          example: C1234
        type:
          type: string
          description: Type of Apply user
          example: candidate
        attributes:
          "$ref": "#/components/schemas/CandidateAttributes"
    CandidateAttributes:
      type: object
      required:
        - email_address
        - created_at
        - updated_at
        - application_forms
      properties:
        created_at:
          type: string
          format: date-time
          description: Time of candidate creation
          example: 2021-05-20T12:34:00Z
        updated_at:
          type: string
          format: date-time
          description: Time of last change
          example: 2021-05-20T12:34:00Z
        email_address:
          type: string
          description: Candidate email address
          example: email@example.com
        application_forms:
          type: array
          items:
            "$ref": "#/components/schemas/ApplicationForm"
    ApplicationForm:
      type: object
      required:
        - id
        - created_at
        - application_status
        - application_phase
        - recruitment_cycle_year
        - submitted_at
      properties:
        id:
          type: integer
          description: The unique ID of the candidates application form
          example: 10
        created_at:
          type: string
          format: date-time
          description: The date an application was created
          example: 2021-05-20T12:34:00Z
        updated_at:
          type: string
          format: date-time
          description: Time of last change
          example: 2021-05-20T12:34:00Z
        application_status:
          type: string
          description: The status of the candidates current application form
          enum:
            - never_signed_in
            - unsubmitted_not_started_form
            - unsubmitted_in_progress
            - awaiting_provider_decisions
            - awaiting_candidate_response
            - recruited
            - pending_conditions
            - offer_deferred
            - ended_without_success
            - unknown_state
          example: awaiting_provider_decisions
        application_phase:
          type: string
          description: The phase of the candidates current application. In the first phase, "Apply 1", the
            candidate can choose up to 3 courses. If all of those choices are rejected,
            declined, or withdrawn, the user can go into "Apply 2".
            In "Apply 2", a user can also choose up to 3 courses.
          enum:
            - apply_1
            - apply_2
          example: apply_1
        recruitment_cycle_year:
          type: integer
          description: The recruitment cycle that the application form was created in
          example: 2022
        submitted_at:
          type: string
          nullable: true
          format: date-time
          description: Time of last change
          example: 2021-05-20T12:34:00Z
        application_choices:
          type: array
          items:
            "$ref": "#/components/schemas/ApplicationChoice"
    ApplicationChoice:
      type: object
      required:
        - id
        - created_at
        - updated_at
        - status
        - provider
        - course
      properties:
        id:
          type: integer
          description: The unique ID of the application choice
          example: 10
        created_at:
          type: string
          format: date-time
          description: The date and time the application choice was created
          example: 2021-05-20T12:34:00Z
        updated_at:
          type: string
          format: date-time
          description: The date and time the application choice was last updated
          example: 2021-05-20T12:34:00Z
        status:
          type: string
          description: The status of the application choice
          enum:
            - unsubmitted
            - cancelled
            - awaiting_provider_decision
            - interviewing
            - offer
            - pending_conditions
            - recruited
            - rejected
            - application_not_sent
            - offer_withdrawn
            - declined
            - withdrawn
            - conditions_not_met
            - offer_deferred
          example: awaiting_provider_decision
        course:
          type: object
          items:
            "$ref": "#/components/schemas/Course"
        provider:
          type: object
          items:
            "$ref": "#/components/schemas/Provider"
        interviews:
          type: array
          items:
            "$ref": "#/components/schemas/Interview"
    Course:
      type: object
      required:
        - uuid
        - name
      properties:
        uuid:
          type: string
          description: The universally unique ID of the course
          example: f2c0ada1-0d99-4574-a950-bf53e176507c
        name:
          type: string
          description: The name of the course
          example: Mathematics
    Provider:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          description: The name of the provider
          example: University of West Anglia
    Interview:
      type: object
      required:
        - id
        - created_at
        - updated_at
        - date_and_time
      properties:
        id:
          type: integer
          description: The unique ID of the interview
          example: 10
        created_at:
          type: string
          format: date-time
          description: The date and time the interview was created
          example: 2021-05-20T12:34:00Z
        updated_at:
          type: string
          format: date-time
          description: The date and time the interview was last updated
          example: 2021-05-20T12:34:00Z
        date_and_time:
          type: string
          format: date-time
          description: The date and time that the interview is scheduled for
          example: 2021-05-20T10:00:00Z
        cancelled_at:
          type: string
          format: date-time
          description: The date and time the interview was cancelled (if applicable)
          example: 2021-05-20T12:34:00Z
    UnauthorizedResponse:
      type: object
      required:
      - errors
      properties:
        errors:
          type: array
          minItems: 1
          description: Error objects describing the problem
          items:
            "$ref": "#/components/schemas/Error"
          example:
          - error: Unauthorized
            message: Please provide a valid authentication token
    ParameterMissingResponse:
      type: object
      required:
      - errors
      properties:
        errors:
          type: array
          minItems: 1
          description: Error objects describing the problem
          items:
            "$ref": "#/components/schemas/Error"
          example:
          - error: ParameterMissing
            message: "param is missing or the value is empty: updated_since"
    ParameterInvalidResponse:
      type: object
      required:
      - errors
      properties:
        errors:
          type: array
          minItems: 1
          description: Error objects describing the problem
          items:
            "$ref": "#/components/schemas/Error"
          example:
          - error: ParameterInvalid
            message: "Parameter is invalid: updated_since"
    PageParameterInvalidResponse:
      type: object
      required:
        - errors
      properties:
        errors:
          type: array
          minItems: 1
          description: Error objects describing the problem
          items:
            "$ref": "#/components/schemas/Error"
          example:
          - error: PageParameterInvalid
            message: "expected 'page' parameter to be between 1 and 1, got 2"
    PerPageParameterInvalidResponse:
      type: object
      required:
        - errors
      properties:
        errors:
          type: array
          minItems: 1
          description: Error objects describing the problem
          items:
            "$ref": "#/components/schemas/Error"
          example:
          - error: PerPageParameterInvalid
            message: "the 'per_page' parameter cannot exceed 500 results per page"
    Error:
      type: object
      additionalProperties: false
      properties:
        error:
          type: string
          description: Name of the current error
          example: Unauthorized
        message:
          type: string
          description: Description of the current error
          example: Please provide a valid authentication token
      required:
      - error
      - message
  securitySchemes:
    tokenAuth:
      type: http
      scheme: bearer
security:
- tokenAuth: []
